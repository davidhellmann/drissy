{# @var craft \craft\web\twig\variables\CraftVariable #}
{# @var entry \craft\elements\Entry #}

{#
Layout: Default
------------------------------------------------------------

#}

{%- minify -%}
{# -- get compilation hash:8 for cachebusting -- #}
<% assetHash = compilation.hash.slice(0, 7) %>
{# -- set assetHash and baseUrl -- #}
{% set assetHash = '<%- assetHash %>' %}
{% set baseUrl = alias('@web') %}
{% header "Link: <#{baseUrl}/>; rel=dns-prefetch;,<#{baseUrl}>; rel=preconnect; crossorigin;" %}
<!DOCTYPE html>
<!-- Fonts Cookie -->
<% if (htmlWebpackPlugin.options.env.prod) { %>
    {% set fontsLoaded = getCookie('fonts-loaded') %}
    {% if fontsLoaded and fontsLoaded == assetHash %}
<html class="fonts-loaded" lang="{{ craft.app.language |slice(0,2) }}"
      prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
{% else %}
<html lang="{{ craft.app.language |slice(0,2) }}"
      prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
{% endif %}
<% } else{ %>
<html class="fonts-loaded" lang="{{ craft.app.language |slice(0,2) }}"
      prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<% } %>

<head>
    <link rel="dns-prefetch" href="{{ baseUrl }}/">
    <link rel="preconnect" href="{{ baseUrl }}/" crossorigin>
    <!-- Any <link> tags that should be included in the header -->
    {% block head %}{% endblock %}
    <!-- Set character encoding for the document -->
    <meta charset="utf-8">
    <!-- Viewport for responsive web design -->
    <meta name="viewport"
          content="width=device-width, initial-scale=1, viewport-fit=cover">


    <!-- Seomatic -->
    {% if craft.plugin.Seomatic is defined %}
        {% hook 'seomaticRender' %}
    {% else %}
        {% block metadata %}
            <title>{{ currentSite.name }}</title>
            <!-- Meta Description -->
            <meta name="description"
                  content="Description of the page less than 150 characters">
        {% endblock %}
    {% endif %}

    {# -- CRITICAL CSS -- #}
    <% if (htmlWebpackPlugin.options.env.prod) { %>
        {% set criticalCss = getCookie('critical-css') %}
        {% if criticalCss and criticalCss == assetHash %}
            {{ craft.twigpack.includeCssModule("styles.css") }}
        {% else %}
            {{ setCookie('critical-css', assetHash, now | date_modify("+7 days").timestamp ) }}
            {{ craft.twigpack.includeCriticalCssTags() }}
            {{ craft.twigpack.includeCssModule("styles.css", true) }}
            {{ craft.twigpack.includeCssRelPreloadPolyfill() }}
        {% endif %}
    <% } %>

    {# -- Fontface Observer -- #}
    <style>
        {{ craft.twigpack.includeFile("@webroot/dist/css/webfonts.css") }}
    </style>
    <% if (htmlWebpackPlugin.options.env.prod) { %>
        {% if fontsLoaded and fontsLoaded == assetHash %}
        {% else %}
        <script>
            (function() {
                // Optimization for Repeat Views
                if (sessionStorage.foftFontsLoaded) {
                    document.documentElement.className += "fonts-loaded";
                    return;
                }
                {{ craft.twigpack.includeFile("@webroot/dist/js/fontfaceobserver.js") }}
                {{ craft.twigpack.includeFile("@webroot/dist/js/load-fonts.js") }}
            })();
        </script>
        {{ setCookie('fonts-loaded', assetHash, now | date_modify("+7 days").timestamp ) }}
        {% endif %}
    <% } %>

    {# -- inlineJs-- #}
    <script>
        {{ craft.twigpack.includeFile("@webroot/dist/js/service-worker.js") }}
        {{ craft.twigpack.includeFile("@webroot/dist/js/tab-handler.js") }}
    </script>

    {%- endminify -%}

</head>

<% if (htmlWebpackPlugin.options.env.prod) { %>
    {%- minify -%}
<% } %>
<body itemscope itemtype="http://schema.org/WebPage">


{% block body %}

{# -- Debug -- #}
{% block debug %}
<% if (htmlWebpackPlugin.options.env.dev) { %>
    {% if craft.app.config.general.devMode %}
    <div id="debug">
        <div
                class="mb-2 ml-2 fixed bottom-0 left-0 rounded-full bg-grey px-4 py-2 font-extrabold z-50 cursor-pointer"
                v-on:click="openDebug()">D
        </div>
        <div
                class="hidden fixed z-30 opacity-100 pin-x bottom-0 bg-red-400 p-4 w-full"
                ref="debugMode">
            <p class="text-sm text-red font-extrabold underline text-center">
                DEBUG</p>
            <div class="w-full flex container mx-auto flex-wrap">
                {% if craft.app.request.getSegment(1) != 'shop' %}
                <div class="mx-auto w-full pt-2">
                    <p class="text-sm text-grey-darkest font-extrabold mb-2 -mt-2 ">
                        entry.slug -
                        <span
                                class="text-red font-bold">{{ entry.slug }}</span>
                    </p>
                    <p class="text-sm text-grey-darkest font-extrabold mb-2 -mt-2 ">
                        entry.title -
                        <span
                                class="text-red font-bold">{{ entry.title }}</span>
                    </p>
                    <p class="text-sm text-grey-darkest font-extrabold mb-2 -mt-2 ">
                        entry.type -
                        <span
                                class="text-red font-bold">{{ entry.type }}</span>
                    </p>
                    <p class="text-sm text text-grey-darkest font-extrabold mb-2 -mt-2 ">
                        section.handle -
                        <span
                                class="text-red font-bold">{{ entry.section.handle }}</span>
                    </p>
                    <p class="text-sm text-grey-darkest font-extrabold mb-2 -mt-2 ">
                        app.request.pathInfo -
                        <span
                                class="text-red font-bold">{{ craft.app.request.pathInfo }}</span>
                    </p>
                    <p class="text-sm text-grey-darkest font-extrabold -mt-2 ">
                        template path -
                        <span
                                class="text-red font-bold">./templates/entry/{{ entry.section.type == 'channel' ? '' : entry.section.handle ~ '/' }}{{ entry.type }}
                                            .twig</span>
                    </p>
                </div>
                {% endif %}
                {% if craft.app.session.hasFlash('notice') or craft.app.session.hasFlash('error') %}
                {% set isErrors = true %}
                {% set noticeFlash = craft.app.session.getFlash('notice')|join('|') %}
                {% set errorFlash = craft.app.session.getFlash('error')|join('|') %}
                <div class="w-full pt-2">
                    {% if noticeFlash %}
                    <div
                            class="w-1/3 mx-auto bg-green text-white my-2">
                        <div class="text-sm font-bold p-2">
                            {{ noticeFlash }}
                        </div>
                    </div>
                    {% endif %}
                    {% if errorFlash %}
                    <div
                            class="w-1/3 mx-auto bg-red text-white my-2">
                        <div class="text-sm font-bold p-2">
                            {{ errorFlash }}
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
<% } %>
{% endblock %}

{% block header %}{% endblock %}

<main id="app">
    {% block content %}{% endblock %}
</main>

{% block footer %}
    {% include '_components/footer/default' with {
        opt : {
            data: contact.globalContact.all(),
        el: {
            nav: 'default',
        },
    },
} only %}
{% endblock %}

{% endblock %}


{% block scripts %}
<script>
    window.csrfTokenValue = "{{ craft.app.request.csrfToken|e('js') }}"
</script>
{% endblock %}

{{ craft.twigpack.includeSafariNomoduleFix() }}
{{ craft.twigpack.includeJsModule("app.js", true) }}

</body>
<% if (htmlWebpackPlugin.options.env.prod) { %>
    {%- endminify -%}
<% } %>

</html>
